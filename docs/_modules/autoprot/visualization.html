
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>autoprot.visualization &#8212; autoprot  documentation</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">autoprot</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../preprocessing.html">
  Data Preprocessing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../analysis.html">
  Analysis
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../clustering.html">
  Clustering
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../visualization.html">
  Data Visualization
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../workflows.html">
  Workflows
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for autoprot.visualization</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Autoprot Visualisation Functions.</span>

<span class="sd">@author: Wignand</span>

<span class="sd">@documentation: Julian</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">autoprot</span> <span class="kn">import</span> <span class="n">venn</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn2</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn3</span>
<span class="kn">import</span> <span class="nn">logomaker</span>
<span class="kn">import</span> <span class="nn">colorsys</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">STOPWORDS</span>

<span class="kn">from</span> <span class="nn">pdfminer3.layout</span> <span class="kn">import</span> <span class="n">LAParams</span>
<span class="kn">from</span> <span class="nn">pdfminer3.pdfpage</span> <span class="kn">import</span> <span class="n">PDFPage</span>
<span class="kn">from</span> <span class="nn">pdfminer3.pdfinterp</span> <span class="kn">import</span> <span class="n">PDFResourceManager</span><span class="p">,</span> <span class="n">PDFPageInterpreter</span>
<span class="kn">from</span> <span class="nn">pdfminer3.converter</span> <span class="kn">import</span> <span class="n">TextConverter</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;pdf.fonttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>


<span class="c1"># TODO: Add functionality of embedding all the plots as subplots in figures by providing ax parameter</span>

<div class="viewcode-block" id="correlogram"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.correlogram">[docs]</a><span class="k">def</span> <span class="nf">correlogram</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">&quot;proteinGroups&quot;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">saveDir</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">saveType</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">saveName</span><span class="o">=</span><span class="s2">&quot;pairPlot&quot;</span><span class="p">,</span> <span class="n">lowerTriang</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
                <span class="n">sampleFrac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot a pair plot of the dataframe intensity columns in order to assess the reproducibility.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The lower half of the correlogram shows a scatter plot comparing pairs of</span>
<span class="sd">    conditions while the upper part shows you the color coded correlation</span>
<span class="sd">    coefficients as well as the intersection of hits between both conditions.</span>
<span class="sd">    In tiles corresponding to self-comparison (the same value on y and x axis)</span>
<span class="sd">    a histogram of intensities is plotted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.df</span>
<span class="sd">        Dataframe from MaxQuant file.</span>
<span class="sd">    columns : list of strings, optional</span>
<span class="sd">        The columns to be visualized. The default is None.</span>
<span class="sd">    file : str, optional</span>
<span class="sd">        &quot;proteinGroups&quot; or &quot;Phospho(STY)&quot; (does only change annotation).</span>
<span class="sd">        The default is &quot;proteinGroups&quot;.</span>
<span class="sd">    log : bool, optional</span>
<span class="sd">        Whether provided intensities are already log transformed.</span>
<span class="sd">        The default is True.</span>
<span class="sd">    saveDir : str, optional</span>
<span class="sd">        Where the plots are saved. The default is None.</span>
<span class="sd">    saveType : str, optional</span>
<span class="sd">        What format the saved plots have (pdf, png). The default is &quot;pdf&quot;.</span>
<span class="sd">    saveName : str, optional</span>
<span class="sd">        The name of the saved file. The default is &quot;pairPlot&quot;.</span>
<span class="sd">    lowerTriang : &quot;scatter&quot;, &quot;hexBin&quot; or &quot;hist2d&quot;, optional</span>
<span class="sd">        The kind of plot displayed in the lower triang.</span>
<span class="sd">        The default is &quot;scatter&quot;.</span>
<span class="sd">    sampleFrac : float, optional</span>
<span class="sd">        Fraction between 0 and 1 to indicate fraction of entries to be shown in scatter.</span>
<span class="sd">        Might be useful for large correlograms in order to make it possible</span>
<span class="sd">        to work with those in illustrator.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    bins : int, optional</span>
<span class="sd">        Number of bins for histograms.</span>
<span class="sd">        The default is 100.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If provided list of columns is not suitable.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You may for example plot the protein intensitites of a single condition of</span>
<span class="sd">    your experiment .</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.correlogram(prot,mildLogInt, file=&#39;proteinGroups&#39;, lowerTriang=&quot;hist2d&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context_: close-figs</span>

<span class="sd">        import pandas as pd</span>
<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>

<span class="sd">        twitchInt = [&#39;Intensity H BC18_1&#39;,&#39;Intensity M BC18_2&#39;,&#39;Intensity H BC18_3&#39;,</span>
<span class="sd">                     &#39;Intensity H BC36_1&#39;,&#39;Intensity H BC36_2&#39;,&#39;Intensity M BC36_2&#39;]</span>
<span class="sd">        ctrlInt = [&quot;Intensity L BC18_1&quot;,&quot;Intensity L BC18_2&quot;,&quot;Intensity L BC18_3&quot;,</span>
<span class="sd">                   &quot;Intensity L BC36_1&quot;, &quot;Intensity L BC36_2&quot;,&quot;Intensity L BC36_2&quot;]</span>
<span class="sd">        mildInt = [&quot;Intensity M BC18_1&quot;,&quot;Intensity H BC18_2&quot;,&quot;Intensity M BC18_3&quot;,</span>
<span class="sd">                   &quot;Intensity M BC36_1&quot;,&quot;Intensity M BC36_2&quot;,&quot;Intensity H BC36_2&quot;]</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.log(prot, twitchInt+ctrlInt+mildInt, base=10)</span>
<span class="sd">        twitchLogInt = [f&quot;log10_{i}&quot; for i in twitchInt]</span>
<span class="sd">        mildLogInt = [f&quot;log10_{i}&quot; for i in mildInt]</span>

<span class="sd">        vis.correlogram(prot,mildLogInt, file=&#39;proteinGroups&#39;, lowerTriang=&quot;hist2d&quot;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    You may want to change the plot type on the lower left triangle.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.correlogram(prot,mildLogInt, file=&#39;proteinGroups&#39;, lowerTriang=&quot;hexBin&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context_: close-figs</span>

<span class="sd">        vis.correlogram(prot,mildLogInt, file=&#39;proteinGroups&#39;, lowerTriang=&quot;hexBin&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">getColor</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mf">0.8</span><span class="p">:</span> <span class="s2">&quot;#d67677&quot;</span><span class="p">,</span>
        <span class="mf">0.81</span><span class="p">:</span> <span class="s2">&quot;#d7767c&quot;</span><span class="p">,</span>
        <span class="mf">0.82</span><span class="p">:</span> <span class="s2">&quot;#d87681&quot;</span><span class="p">,</span>
        <span class="mf">0.83</span><span class="p">:</span> <span class="s2">&quot;#da778c&quot;</span><span class="p">,</span>
        <span class="mf">0.84</span><span class="p">:</span> <span class="s2">&quot;#dd7796&quot;</span><span class="p">,</span>
        <span class="mf">0.85</span><span class="p">:</span> <span class="s2">&quot;#df78a1&quot;</span><span class="p">,</span>
        <span class="mf">0.86</span><span class="p">:</span> <span class="s2">&quot;#e179ad&quot;</span><span class="p">,</span>
        <span class="mf">0.87</span><span class="p">:</span> <span class="s2">&quot;#e379b8&quot;</span><span class="p">,</span>
        <span class="mf">0.88</span><span class="p">:</span> <span class="s2">&quot;#e57ac4&quot;</span><span class="p">,</span>
        <span class="mf">0.89</span><span class="p">:</span> <span class="s2">&quot;#e77ad0&quot;</span><span class="p">,</span>
        <span class="mf">0.90</span><span class="p">:</span> <span class="s2">&quot;#ea7bdd&quot;</span><span class="p">,</span>
        <span class="mf">0.91</span> <span class="p">:</span> <span class="s2">&quot;#ec7bea&quot;</span><span class="p">,</span>
        <span class="mf">0.92</span> <span class="p">:</span> <span class="s2">&quot;#e57cee&quot;</span><span class="p">,</span>
        <span class="mf">0.93</span> <span class="p">:</span> <span class="s2">&quot;#dc7cf0&quot;</span><span class="p">,</span>
        <span class="mf">0.94</span> <span class="p">:</span> <span class="s2">&quot;#d27df2&quot;</span><span class="p">,</span>
        <span class="mf">0.95</span> <span class="p">:</span> <span class="s2">&quot;#c87df4&quot;</span><span class="p">,</span>
        <span class="mf">0.96</span> <span class="p">:</span> <span class="s2">&quot;#be7df6&quot;</span><span class="p">,</span>
        <span class="mf">0.97</span> <span class="p">:</span> <span class="s2">&quot;#b47ef9&quot;</span><span class="p">,</span>
        <span class="mf">0.98</span> <span class="p">:</span> <span class="s2">&quot;#a97efb&quot;</span><span class="p">,</span>
        <span class="mf">0.99</span> <span class="p">:</span> <span class="s2">&quot;#9e7ffd&quot;</span><span class="p">,</span>
        <span class="mi">1</span> <span class="p">:</span> <span class="s2">&quot;#927fff&quot;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;#D63D40&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">corrfunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate correlation coefficient and add text to axis.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;r = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">heatmap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate correlation coefficient and add coloured tile to axis.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">getColor</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
                                           <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lowerScatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot data points as scatter plot to axis.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">sampleFrac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">sampleFrac</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lowerHexBin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot data points as hexBin plot to axis.&quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lowerhist2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot data points as hist2d plot to axis.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">proteins_found</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;proteinGroups&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> proteins identified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))),</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;R: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">2</span><span class="p">))),</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span><span class="mf">.5</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;Phospho (STY)&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peptides identified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))),</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;R: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">2</span><span class="p">))),</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span><span class="mf">.5</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No columns provided!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># select columns for plotting</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>

    <span class="c1"># perform log transformation if not already done</span>
    <span class="k">if</span> <span class="n">log</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
    <span class="c1"># avoid inf values from log transformation</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># maps each pairwise combination of column onto an axis grid</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="c1"># accesses the lower triangle</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">corrfunc</span><span class="p">)</span>
    <span class="c1"># plot the data points on the lower triangle</span>
    <span class="k">if</span> <span class="n">lowerTriang</span> <span class="o">==</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">lowerScatter</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">lowerTriang</span> <span class="o">==</span> <span class="s2">&quot;hexBin&quot;</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">lowerHexBin</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">lowerTriang</span> <span class="o">==</span> <span class="s2">&quot;hist2d&quot;</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">lowerhist2D</span><span class="p">)</span>
    <span class="c1"># histograms on the diagonal</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">)</span>
    <span class="c1"># coloured tiles for the upper triangle</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>
    <span class="c1"># annotate the number of identified proteins</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">proteins_found</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">saveDir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">saveType</span> <span class="o">==</span> <span class="s2">&quot;pdf&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">saveDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveName</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">saveType</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">saveDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveName</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="corrMap"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.corrMap">[docs]</a><span class="k">def</span> <span class="nf">corrMap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGn&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span>
            <span class="n">saveDir</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">saveType</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">saveName</span><span class="o">=</span><span class="s2">&quot;pairPlot&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot correlation heat- and clustermaps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.df</span>
<span class="sd">        Dataframe from MaxQuant file.</span>
<span class="sd">    columns : list of strings, optional</span>
<span class="sd">        The columns to be visualized. The default is None.</span>
<span class="sd">    cluster : bool, optional</span>
<span class="sd">        Whether to plot a clustermap.</span>
<span class="sd">        If True, only a clustermap will be returned.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    annot : bool or rectangular dataset, optional</span>
<span class="sd">        If True, write the data value in each cell.</span>
<span class="sd">        If an array-like with the same shape as data, then use this to annotate</span>
<span class="sd">        the heatmap instead of the data. Note that DataFrames will match on</span>
<span class="sd">        position, not index. The default is None.</span>
<span class="sd">    cmap : matplotlib colormap name or object, or list of colors, optional</span>
<span class="sd">        The mapping from data values to color space.</span>
<span class="sd">        The default is &quot;YlGn&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Size of the figure. The default is (7,7).</span>
<span class="sd">    saveDir : str, optional</span>
<span class="sd">        Where the plots are saved. The default is None.</span>
<span class="sd">    saveType : str, optional</span>
<span class="sd">        What format the saved plots have (pdf, png). The default is &quot;pdf&quot;.</span>
<span class="sd">    saveName : str, optional</span>
<span class="sd">        The name of the saved file. The default is &quot;pairPlot&quot;.</span>
<span class="sd">    ax : plt.axis, optional</span>
<span class="sd">        The axis to plot. The default is None.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        passed to seaborn.heatmap and seaborn.clustermap.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    To plot a heatmap with annotated values call corrMap directly:</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.corrMap(prot,mildLogInt, annot=True)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        mildInt = [&quot;Intensity M BC18_1&quot;,&quot;Intensity H BC18_2&quot;,&quot;Intensity M BC18_3&quot;,</span>
<span class="sd">                   &quot;Intensity M BC36_1&quot;,&quot;Intensity M BC36_2&quot;,&quot;Intensity H BC36_2&quot;]</span>
<span class="sd">        prot = pp.log(prot, mildInt, base=10)</span>
<span class="sd">        mildLogInt = [f&quot;log10_{i}&quot; for i in mildInt]</span>
<span class="sd">        vis.corrMap(prot,mildLogInt, annot=True)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    If you want to plot the clustermap, set cluster to True.</span>
<span class="sd">    The correlation coefficients are colour-coded.</span>

<span class="sd">    &gt;&gt;&gt;  autoprot.visualization.corrMap(prot, mildLogInt, cmap=&quot;autumn&quot;, annot=None, cluster=True)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        vis.corrMap(prot, mildLogInt, cmap=&quot;autumn&quot;, annot=None, cluster=True)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cluster</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">saveDir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">saveType</span> <span class="o">==</span> <span class="s2">&quot;pdf&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">saveDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveName</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">saveType</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">saveDir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveName</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="probPlot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.probPlot">[docs]</a><span class="k">def</span> <span class="nf">probPlot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="s2">&quot;norm&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a QQ_plot of the provided column.</span>

<span class="sd">    Data are compared against a theoretical distribution (default is normal)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    col : list of str</span>
<span class="sd">        Columns containing the data for analysis.</span>
<span class="sd">    dist : str or stats.distributions instance, optional, optional</span>
<span class="sd">        Distribution or distribution function name.</span>
<span class="sd">        The default is norm for a normal probability plot.</span>
<span class="sd">        Objects that look enough like a stats.distributions instance</span>
<span class="sd">        (i.e. they have a ppf method) are also accepted.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Size of the figure. The default is (6,6).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot to check if the experimental data points follow the distribution function</span>
<span class="sd">    indicated by dist.</span>

<span class="sd">    &gt;&gt;&gt; vis.probPlot(prot,&#39;log10_Intensity H BC18_1&#39;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protInt = prot.filter(regex=&#39;Intensity&#39;).columns</span>
<span class="sd">        prot = pp.log(prot, protInt, base=10)</span>

<span class="sd">        vis.probPlot(prot,&#39;log10_Intensity H BC18_1&#39;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    In contrast when the data does not follow the distribution, outliers from the</span>
<span class="sd">    linear plot will be visible.</span>

<span class="sd">    &gt;&gt;&gt; vis.probPlot(prot,&#39;log10_Intensity H BC18_1&#39;, dist=stats.uniform)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import scipy.stats as stats</span>
<span class="sd">        vis.probPlot(prot,&#39;log10_Intensity H BC18_1&#39;, dist=stats.uniform)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;R: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Probability Plot</span><span class="se">\n</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Theorectical Quantiles&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sample Quantiles&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></div>


<div class="viewcode-block" id="boxplot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.boxplot">[docs]</a><span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">reps</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="s2">&quot;logFC&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retFig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot intensity boxplots.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.Dataframe</span>
<span class="sd">        INput dataframe.</span>
<span class="sd">    reps : list of str</span>
<span class="sd">        Colnames of replicates.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title of the plot. The default is None.</span>
<span class="sd">    labels : list of str, optional</span>
<span class="sd">        List with labels for the axis.</span>
<span class="sd">        The default is [].</span>
<span class="sd">    compare : bool, optional</span>
<span class="sd">        If False reps is expected to be a single list,</span>
<span class="sd">        if True two list are expected (e.g. normalized and non-normalized Ratios).</span>
<span class="sd">        The default is False.</span>
<span class="sd">    data : str, optional</span>
<span class="sd">        Either &quot;logFC&quot; or &quot;Intensity&quot;. The default is &quot;logFC&quot;.</span>
<span class="sd">    file : str, optional</span>
<span class="sd">        Path to a folder where the figure should be saved.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether to return the figure object.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Figure size. The default is (15,5).</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Passed to pandas boxplot.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the reps input does not match the compare setting.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : plt.figure</span>
<span class="sd">        Plot figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    To inspect unnormalised data, you can generate a boxplot comparing the</span>
<span class="sd">    fold-change differences between conditions or replicates</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.boxplot(df=prot,reps=protRatio, compare=False,</span>
<span class="sd">    ...                                labels=labels, title=&quot;Unnormalized Ratios Boxplot&quot;,</span>
<span class="sd">    ...                                data=&quot;logFC&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import pandas as pd</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.preprocessing as pp</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;Ratio .\/. BC.*_1&quot;).columns</span>
<span class="sd">        prot = pp.log(prot, protRatio, base=2)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;log2_Ratio.*&quot;).columns</span>
<span class="sd">        prot = pp.vsn(prot, protRatio)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;log2_Ratio.*_1$&quot;).columns</span>
<span class="sd">        labels = [i.split(&quot; &quot;)[1]+&quot;_&quot;+i.split(&quot; &quot;)[-1] for i in protRatio]</span>
<span class="sd">        vis.boxplot(df=prot,reps=protRatio, compare=False, labels=labels, title=&quot;Unnormalized Ratios Boxplot&quot;,</span>
<span class="sd">                data=&quot;logFC&quot;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    If you have two datasets for comparison (e.g. normalised and non-normalised)</span>
<span class="sd">    fold-changes, you can use boxplot to plot them side-by-side.</span>

<span class="sd">    &gt;&gt;&gt; vis.boxplot(prot,[protRatio, protRatioNorm], compare=True, labels=labels,</span>
<span class="sd">    ...             title=[&quot;unormalized&quot;, &quot;normalized&quot;], data=&quot;logFC&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        protRatioNorm = prot.filter(regex=&quot;log2_Ratio.*normalized&quot;).columns</span>
<span class="sd">        vis.boxplot(prot,[protRatio, protRatioNorm], compare=True, labels=labels, title=[&quot;unormalized&quot;, &quot;normalized&quot;],</span>
<span class="sd">                   data=&quot;logFC&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if inputs make sense</span>
    <span class="k">if</span> <span class="n">compare</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You want to compare two sets, provide two sets.&quot;</span><span class="p">)</span>

    <span class="c1">#set ylabel based on data</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;logFC&quot;</span><span class="p">:</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;logFC&quot;</span>
    <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;Intensity&quot;</span><span class="p">:</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Intensity&quot;</span>

    <span class="k">if</span> <span class="n">compare</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reps</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">rep</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;logFC&quot;</span><span class="p">:</span>
                 <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
                <span class="n">tlabel</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tlabel</span><span class="p">):</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">.05</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]))])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]))])</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="n">reps</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">.05</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reps</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;logFC&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">/BoxPlot.pdf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="intensityRank"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.intensityRank">[docs]</a><span class="k">def</span> <span class="nf">intensityRank</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rankCol</span><span class="o">=</span><span class="s2">&quot;log10_Intensity&quot;</span> <span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rank Plot&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a rank plot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    rankCol : str, optional</span>
<span class="sd">        the column with the values to be ranked (e.g. Intensity values).</span>
<span class="sd">        The default is &quot;log10_Intensity&quot;.</span>
<span class="sd">    label : str, optional</span>
<span class="sd">        Colname of the column with the labels.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    n : int, optional</span>
<span class="sd">        How many points to label on the top and bottom of the y-scale.</span>
<span class="sd">        The default is 5.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        The title of the plot.</span>
<span class="sd">        The default is &quot;Rank Plot&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        The figure size. The default is (15,7).</span>
<span class="sd">    file : str, optional</span>
<span class="sd">        Path to a folder where the resulting sigure should be saved.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    hline : numeric, optional</span>
<span class="sd">        y value to place a horizontal line.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    ax : matplotlib.axis</span>
<span class="sd">        Axis to plot on</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Passed to seaborn.scatterplot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Annotate a protein groups datafile with the proteins of highest and lowest</span>
<span class="sd">    intensity. The 15 most and least intense proteins will be labelled.</span>
<span class="sd">    Note that marker is passed to seaborn and results in points marked as diamonds.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.intensityRank(data, rankCol=&quot;log10_Intensity&quot;,</span>
<span class="sd">    ...                                      label=&quot;Gene names&quot;, n=15,</span>
<span class="sd">    ...                                      title=&quot;Rank Plot&quot;,</span>
<span class="sd">    ...                                      hline=8, marker=&quot;d&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        data = pp.log(prot,[&quot;Intensity&quot;], base=10)</span>
<span class="sd">        data = data[[&quot;log10_Intensity&quot;, &quot;Gene names&quot;]]</span>
<span class="sd">        data = data[data[&quot;log10_Intensity&quot;]!=-np.inf]</span>

<span class="sd">        vis.intensityRank(data, rankCol=&quot;log10_Intensity&quot;, label=&quot;Gene names&quot;, n=15, title=&quot;Rank Plot&quot;,</span>
<span class="sd">                         hline=8, marker=&quot;d&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ToDo: add option to highlight a set of datapoints could be alternative to topN labeling</span>

    <span class="c1"># remove NaNs</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">rankCol</span><span class="p">])</span>

    <span class="c1"># if data has mroe columns than 1</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">rankCol</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">rankCol</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># new plot if no axis was given</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># plot on the axis</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">hline</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># high intensity labels labels</span>
        <span class="n">top_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">top_yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">top_y</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">top_y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">top_oy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
        <span class="n">top_xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
        <span class="n">top_ss</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">ys</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ss</span><span class="p">,</span><span class="n">oy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">top_yy</span><span class="p">,</span> <span class="n">top_xx</span><span class="p">,</span> <span class="n">top_ss</span><span class="p">,</span> <span class="n">top_oy</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xs</span><span class="p">,</span><span class="n">xs</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">.1</span><span class="p">],</span> <span class="p">[</span><span class="n">oy</span><span class="p">,</span> <span class="n">ys</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span>

        <span class="c1"># low intensity labels</span>
        <span class="n">low_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">low_yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low_y</span><span class="p">,</span> <span class="n">low_y</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">low_oy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">low_xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">low_ss</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ys</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ss</span><span class="p">,</span><span class="n">oy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">low_yy</span><span class="p">,</span> <span class="n">low_xx</span><span class="p">,</span> <span class="n">low_ss</span><span class="p">,</span> <span class="n">low_oy</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xs</span><span class="p">,</span><span class="n">xs</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">.1</span><span class="p">],</span> <span class="p">[</span><span class="n">oy</span><span class="p">,</span> <span class="n">ys</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;# rank&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">/RankPlot.pdf&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="vennDiagram"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.vennDiagram">[docs]</a><span class="k">def</span> <span class="nf">vennDiagram</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">retFig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proportional</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw vennDiagrams.</span>

<span class="sd">    The .vennDiagram() function allows to draw venn diagrams for 2 to 6 replicates.</span>
<span class="sd">    Even though you can compare 6 replicates in a venn diagram does not mean</span>
<span class="sd">    that you should. It becomes extremly messy.</span>

<span class="sd">    The labels in the diagram can be read as follows:</span>
<span class="sd">    Comparing two conditions you will see the labels 10, 11 and 01. This can be read as:</span>
<span class="sd">    Only in replicate 1 (10), in both replicates (11) and only in replicate 2 (01).</span>
<span class="sd">    The same notation extends to all venn diagrams.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    vennDiagram compares row containing not NaN between columns. Therefore</span>
<span class="sd">    you have to pass columns containing NaN on rows where no common protein was</span>
<span class="sd">    found (e.g. after ratio calculation).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Figure size. The default is (10,10).</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether to return the figure.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    proportional : bool, optional</span>
<span class="sd">        Whether to draw area-proportiona Venn diagrams.</span>
<span class="sd">        The default is True.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the number of provided columns is below 2 or greater than 6.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure</span>
<span class="sd">        The figure object.</span>
<span class="sd">        Only returned if retFig is True, else None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can specify up to 6 columns containing values and NaNs. Only rows showing</span>
<span class="sd">    values in two columns will be grouped together in the Venn diagram.</span>

<span class="sd">    &gt;&gt;&gt; data = prot[twitchVsmild[:3]]</span>
<span class="sd">    &gt;&gt;&gt; autoprot.visualization.vennDiagram(data, figsize=(5,5))</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;Ratio .\/. BC.*&quot;).columns</span>
<span class="sd">        prot = pp.log(prot, protRatio, base=2)</span>

<span class="sd">        twitchVsmild = [&#39;Ratio H/M BC18_1&#39;,&#39;Ratio M/L BC18_2&#39;,&#39;Ratio H/M BC18_3&#39;,</span>
<span class="sd">                        &#39;Ratio H/L BC36_1&#39;,&#39;Ratio H/M BC36_2&#39;,&#39;Ratio M/L BC36_2&#39;]</span>


<span class="sd">        data = prot[twitchVsmild[:3]]</span>
<span class="sd">        vis.vennDiagram(data, figsize=(5,5))</span>
<span class="sd">        plt.show()</span>

<span class="sd">    Only up to three conditions can be compared in non-proportional Venn</span>
<span class="sd">    diagrams</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.vennDiagram(data, figsize=(5,5), proportional=False)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        vis.vennDiagram(data, figsize=(5,5), proportional=False)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    Copmaring up to 6 conditions is possible but the resulting Venn diagrams</span>
<span class="sd">    get quite messy.</span>

<span class="sd">    &gt;&gt;&gt; data = prot[twitchVsmild[:6]]</span>
<span class="sd">    &gt;&gt;&gt; vis.vennDiagram(data, figsize=(20,20))</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        data = prot[twitchVsmild[:6]]</span>
<span class="sd">        vis.vennDiagram(data, figsize=(20,20))</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot analyse more than 6 conditions in a venn diagram!&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You should at least provide 2 conditions to compare in a venn diagram!&quot;</span><span class="p">)</span>
    <span class="n">reps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g1</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g2</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g2</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proportional</span><span class="p">:</span>
            <span class="n">venn2</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">],</span> <span class="n">set_labels</span><span class="o">=</span><span class="n">reps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">get_labels</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;logic&quot;</span><span class="p">])</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">venn2</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g1</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g2</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g2</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g3</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g3</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proportional</span><span class="p">:</span>
            <span class="n">venn3</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">g3</span><span class="p">],</span> <span class="n">set_labels</span><span class="o">=</span><span class="n">reps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">get_labels</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;logic&quot;</span><span class="p">])</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">venn3</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g1</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g2</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g2</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g3</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g3</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g4</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g4</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">get_labels</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;logic&quot;</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">venn4</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g5</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g1</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g2</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g2</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g3</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g3</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g4</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g4</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g5</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g5</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g5</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">get_labels</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g5</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;logic&quot;</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">venn5</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g5</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g6</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">reps</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">]]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g1</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g2</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g2</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g3</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g3</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g4</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g4</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g5</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g5</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g5</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">g6</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g6</span><span class="p">[</span><span class="s2">&quot;UID&quot;</span><span class="p">][</span><span class="n">g6</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">get_labels</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g5</span><span class="p">,</span> <span class="n">g6</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;logic&quot;</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">venn</span><span class="o">.</span><span class="n">venn6</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">reps</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">retFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="volcano"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.volcano">[docs]</a><span class="k">def</span> <span class="nf">volcano</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logFC</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">fct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sig_col</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">bg_col</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Volcano Plot&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">hover_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">pointsize_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">highlight_col</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">annotHighlight</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">custom_bg</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">custom_fg</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">custom_hl</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">retFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw Volcano plot.</span>

<span class="sd">    This function can either plot a static or an interactive version of the</span>
<span class="sd">    volcano. Further it allows the user to set the desired logFC and p value</span>
<span class="sd">    threshold as well as toggle the annotation of the plot. If provided it is</span>
<span class="sd">    possible to highlight a selection of datapoints in the plot.</span>
<span class="sd">    Those will then be annotated instead of all significant entries.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        dataframe which contains the data.</span>
<span class="sd">    logFC : str</span>
<span class="sd">        column of the dataframe with the log fold change.</span>
<span class="sd">    p : str, optional</span>
<span class="sd">        column of the dataframe containing p values (provide score or p).</span>
<span class="sd">        The default is None.</span>
<span class="sd">    score : str, optional</span>
<span class="sd">        column of the dataframe containing -log10(p values) (provide score or p).</span>
<span class="sd">        The default is None.</span>
<span class="sd">    pt : float, optional</span>
<span class="sd">        p-value threshold under which a entry is deemed significantly regulated.</span>
<span class="sd">        The default is 0.05.</span>
<span class="sd">    fct : float, optional</span>
<span class="sd">        fold change threshold at which an entry is deemed significant regulated.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    annot : bool, optional</span>
<span class="sd">        whether or not to annotate the plot. The default is None.</span>
<span class="sd">    interactive : bool, optional</span>
<span class="sd">         The default is False.</span>
<span class="sd">    sig_col : str, optional</span>
<span class="sd">        Colour for significant points. The default is &quot;green&quot;.</span>
<span class="sd">    bg_col : str, optional</span>
<span class="sd">        Background colour. The default is &quot;lightgray&quot;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the plot. The default is &quot;Volcano Plot&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Size of the figure. The default is (6,6).</span>
<span class="sd">    hover_name : str, optional</span>
<span class="sd">        Colname to use for labels in interactive plot.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    highlight : pd.index, optional</span>
<span class="sd">        Rows to highlight in the plot.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    pointsize_name: str or float, optional</span>
<span class="sd">        Name of a column to use as emasure for point size.</span>
<span class="sd">        Alternatively the size of all points.</span>
<span class="sd">    highlight_col : str, optional</span>
<span class="sd">        Colour for the highlights. The default is &quot;red&quot;.</span>
<span class="sd">    annotHighlight : str, optional</span>
<span class="sd">        &#39;all&#39; or &#39;sig&#39;.</span>
<span class="sd">        Whether to highlight all rows in indicated by highlight or only</span>
<span class="sd">        the significant positions.</span>
<span class="sd">        The default is &quot;all&quot;.</span>
<span class="sd">    custom_bg : dict, optional</span>
<span class="sd">        Key:value pairs that are passed as kwargs to plt.scatter to define the background.</span>
<span class="sd">        Ignored for the interactive plots.</span>
<span class="sd">        The default is {}.</span>
<span class="sd">    custom_fg : dict, optional</span>
<span class="sd">        Key:value pairs that are passed as kwargs to plt.scatter to define the foreground.</span>
<span class="sd">        Ignored for the interactive plots.</span>
<span class="sd">        The default is {}.</span>
<span class="sd">    custom_hl : dict, optional</span>
<span class="sd">        Key:value pairs that are passed as kwargs to plt.scatter to define the highlighted points.</span>
<span class="sd">        Ignored for the interactive plots.</span>
<span class="sd">        The default is {}.</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether or not to return the figure, can be used to further</span>
<span class="sd">        customize it afterwards.. The default is False.</span>
<span class="sd">    ax : matplotlib.axis, optional</span>
<span class="sd">        Axis to print on. The default is None.</span>
<span class="sd">    legend : bool, optional</span>
<span class="sd">        Whether to plot a legend. The default is True.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If neither a p-score nor a p value is provided by the user.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Setting a strict logFC threshold is arbitrary and should generally be avoided.</span>
<span class="sd">    Annotation of volcano plot can become cluttered quickly.</span>
<span class="sd">    You might want to prettify annotation in illustrator.</span>
<span class="sd">    Alternatively, use VolcanoDashBoard to interactively annotate your Volcano</span>
<span class="sd">    plot or an interactive version of volcano plot to investigate the results.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure</span>
<span class="sd">        The figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The function .volcano() draws a volcano plot.</span>
<span class="sd">    You can either provide precalculated scores or raw (adjusted) p values.</span>
<span class="sd">    You can also set a desired significance threshold (p value as well as logFC).</span>
<span class="sd">    You can customize the volcano plot, for instance you can also choose between</span>
<span class="sd">    interactive and static plot. When you provide a set of indices in the</span>
<span class="sd">    highlight parameter those will be highlighted for you in the plot.</span>

<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;^Ratio .\/.( | normalized )B&quot;).columns</span>
<span class="sd">        prot = pp.log(prot, protRatio, base=2)</span>
<span class="sd">        twitchVsmild = [&#39;log2_Ratio H/M normalized BC18_1&#39;,&#39;log2_Ratio M/L normalized BC18_2&#39;,&#39;log2_Ratio H/M normalized BC18_3&#39;,</span>
<span class="sd">                         &#39;log2_Ratio H/L normalized BC36_1&#39;,&#39;log2_Ratio H/M normalized BC36_2&#39;,&#39;log2_Ratio M/L normalized BC36_2&#39;]</span>
<span class="sd">        prot_limma = ana.limma(prot, twitchVsmild, cond=&quot;_TvM&quot;)</span>
<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    The volcano function allows a certain amount of customisation. E.g. proteins</span>
<span class="sd">    exceeding a certain threshold can be annotated and titles and colours can</span>
<span class="sd">    be adapted to your needs.</span>

<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, pt=0.01,</span>
<span class="sd">    ...             fct=2, annot=&quot;Gene names&quot;, sig_col=&quot;purple&quot;, bg_col=&quot;teal&quot;,</span>
<span class="sd">    ...             title=&quot;Custom Title&quot;, figsize=(15,5))</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, pt=0.01,</span>
<span class="sd">           fct=2, annot=&quot;Gene names&quot;, sig_col=&quot;purple&quot;, bg_col=&quot;teal&quot;,</span>
<span class="sd">           title=&quot;Custom Title&quot;, figsize=(15,5))</span>
<span class="sd">        plt.show()</span>

<span class="sd">    Moreover, custom entries can be highlghted such as target proteins of a study.</span>

<span class="sd">    &gt;&gt;&gt; idx = prot_limma[prot_limma[&#39;logFC_TvM&#39;] &gt; 1].sample(10).index</span>
<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">    ...             figsize=(15,5))</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        idx = prot_limma[prot_limma[&#39;logFC_TvM&#39;] &gt; 1].sample(10).index</span>
<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">                    figsize=(15,5))</span>
<span class="sd">        plt.show()</span>

<span class="sd">    Using dictionaries of matplotlib keywords eventually allows a higher degree</span>
<span class="sd">    of customisation.</span>

<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">    ...             figsize=(15,5), highlight_col = &quot;teal&quot;, sig_col=&quot;lightgray&quot;,</span>
<span class="sd">    ...             custom_bg = {&quot;s&quot;:1, &quot;alpha&quot;:.1},</span>
<span class="sd">    ...             custom_fg = {&quot;s&quot;:5, &quot;alpha&quot;:.33},</span>
<span class="sd">    ...             custom_hl = {&quot;s&quot;:40, &quot;linewidth&quot;:1, &quot;edgecolor&quot;:&quot;purple&quot;})</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">           figsize=(15,5), highlight_col = &quot;teal&quot;, sig_col=&quot;lightgray&quot;,</span>
<span class="sd">           custom_bg = {&quot;s&quot;:1, &quot;alpha&quot;:.1},</span>
<span class="sd">           custom_fg = {&quot;s&quot;:5, &quot;alpha&quot;:.33},</span>
<span class="sd">           custom_hl = {&quot;s&quot;:40, &quot;linewidth&quot;:1, &quot;edgecolor&quot;:&quot;purple&quot;})</span>
<span class="sd">        plt.show()</span>

<span class="sd">    You can also collect the volcano plot on an axis and plot multiple plots</span>
<span class="sd">    on a single figure.</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2, ncols=1, figsize=(15,10))</span>
<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">    ...             figsize=(15,5), ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">    ...             figsize=(15,5), ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set_ylim(2,4)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set_xlim(0,4)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        fig, ax = plt.subplots(nrows=2, ncols=1, figsize=(15,10))</span>
<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">                   figsize=(15,5), ax=ax[0])</span>
<span class="sd">        vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, highlight=idx, annot=&quot;Gene names&quot;,</span>
<span class="sd">                   figsize=(15,5), ax=ax[1])</span>
<span class="sd">        ax[1].set_ylim(2,4)</span>
<span class="sd">        ax[1].set_xlim(0,4)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    If you set the interactive keyword arg to True, you can explore your volcano</span>
<span class="sd">    plots interactively using plotly.</span>

<span class="sd">    &gt;&gt;&gt; vis.volcano(df=prot_limma, logFC=&quot;logFC_TvM&quot;, p=&quot;P.Value_TvM&quot;, interactive=True, hover_name=&quot;Gene names&quot;,</span>
<span class="sd">                    fct=0.4)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">setAesthetic</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">interactive</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set standard aesthetics of volcano and integrate with user defined settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : dict</span>
<span class="sd">            User defined dictionary.</span>
<span class="sd">        typ : str</span>
<span class="sd">            Whether background &#39;bg&#39;, foregorund &#39;fg&#39; or highlight &#39;hl&#39; points.</span>
<span class="sd">        interactive : bool</span>
<span class="sd">            Whether this is an interactive plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : dict</span>
<span class="sd">            The input dict plus standard settings if not specified.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;bg&quot;</span><span class="p">:</span>
            <span class="n">standard</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.33</span><span class="p">,</span>
                           <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                           <span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;background&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="c1">#this hugely improves performance in illustrator</span>

        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;fg&quot;</span><span class="p">:</span>
            <span class="n">standard</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
                           <span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;hl&quot;</span><span class="p">:</span>
            <span class="n">standard</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                           <span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;POI&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">standard</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">standard</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">d</span>


    <span class="k">def</span> <span class="nf">checkData</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">logFC</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">fct</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You have to provide either a score or a (adjusted) p value.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
            <span class="n">score</span> <span class="o">=</span> <span class="s2">&quot;score&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">score</span><span class="p">:</span><span class="s2">&quot;score&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="s2">&quot;score&quot;</span>
            <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># define the significant eintries in dataframe</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">fct</span><span class="p">),</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pt</span><span class="p">),</span> <span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;*&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">unsig</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;-&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">unsig</span>


    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># set up standard aesthetics</span>
    <span class="n">custom_bg</span> <span class="o">=</span> <span class="n">setAesthetic</span><span class="p">(</span><span class="n">custom_bg</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">)</span>
    <span class="n">custom_fg</span> <span class="o">=</span> <span class="n">setAesthetic</span><span class="p">(</span><span class="n">custom_fg</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;fg&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">highlight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_hl</span> <span class="o">=</span> <span class="n">setAesthetic</span><span class="p">(</span><span class="n">custom_hl</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;hl&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">)</span>

    <span class="c1"># check for input correctness and make sure score is present in df for plot</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">unsig</span> <span class="o">=</span> <span class="n">checkData</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">logFC</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">fct</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1">#darw figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span> <span class="c1">#for a bare minimum plot you do not need this line</span>
        <span class="c1">#the following lines of code generate the scatter the rest is styling</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unsig</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unsig</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">bg_col</span><span class="p">,</span> <span class="o">**</span><span class="n">custom_bg</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">sig_col</span><span class="p">,</span> <span class="o">**</span><span class="n">custom_fg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">highlight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">highlight_col</span><span class="p">,</span> <span class="o">**</span><span class="n">custom_hl</span><span class="p">)</span>

        <span class="c1">#draw threshold lines</span>
        <span class="k">if</span> <span class="n">fct</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>

        <span class="c1">#remove of top and right plot boundary</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#seting x and y labels and title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;logFC&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1">#add legend</span>
        <span class="k">if</span> <span class="n">legend</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="c1">#Annotation</span>
        <span class="k">if</span> <span class="n">annot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#get x and y coordinates as well as strings to plot</span>
            <span class="k">if</span> <span class="n">highlight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">annot</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">annotHighlight</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">]</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">]</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">annot</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">annotHighlight</span> <span class="o">==</span> <span class="s2">&quot;sig&quot;</span><span class="p">:</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">highlight</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="n">sig</span><span class="p">)]</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">highlight</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="n">sig</span><span class="p">)]</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">annot</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">highlight</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="n">sig</span><span class="p">)]</span>

            <span class="c1">#annotation</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">ss</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">idx</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">.3</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.25</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">.3</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.25</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">bg_col</span><span class="p">,</span><span class="n">sig_col</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">highlight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">highlight</span><span class="p">,</span> <span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
            <span class="k">if</span> <span class="n">hover_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">hover_name</span><span class="o">=</span><span class="n">hover_name</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="n">pointsize_name</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                 <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="n">pointsize_name</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                 <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hover_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">hover_name</span><span class="o">=</span><span class="n">hover_name</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="n">pointsize_name</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                 <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="n">pointsize_name</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                 <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pt</span><span class="p">)],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#add fold change visualization</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span> <span class="o">-</span><span class="n">fct</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">fct</span><span class="p">,</span> <span class="n">fct</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">({</span>
            <span class="s1">&#39;plot_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(70,70,70,1)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;paper_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(128, 128, 128, 0.25)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="logIntPlot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.logIntPlot">[docs]</a><span class="k">def</span> <span class="nf">logIntPlot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logFC</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">fct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">sig_col</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">bg_col</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;LogFC Intensity Plot&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">hover_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a log-foldchange vs log-intensity plot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    logFC : str</span>
<span class="sd">        Colname containing log fold-changes.</span>
<span class="sd">    Int : str</span>
<span class="sd">        Colname containing the log intensities.</span>
<span class="sd">    fct : float, optional</span>
<span class="sd">        fold change threshold at which an entry is deemed significant regulated.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    annot : bool, optional</span>
<span class="sd">        whether or not to annotate the plot. The default is None.</span>
<span class="sd">    interactive : bool, optional</span>
<span class="sd">         The default is False.</span>
<span class="sd">    sig_col : str, optional</span>
<span class="sd">        Colour for significant points. The default is &quot;green&quot;.</span>
<span class="sd">    bg_col : str, optional</span>
<span class="sd">        Background colour. The default is &quot;lightgray&quot;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the plot.</span>
<span class="sd">        The default is &quot;Volcano Plot&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Size of the figure. The default is (6,6).</span>
<span class="sd">    hover_name : str, optional</span>
<span class="sd">        Colname to use for labels in interactive plot.</span>
<span class="sd">        The default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The logFC Intensity plot requires the log fold changes as calculated e.g.</span>
<span class="sd">    during t-test or LIMMA analysis and (log) intensities to separate points</span>
<span class="sd">    on the y axis.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.logIntPlot(prot_limma, &quot;logFC_TvM&quot;,</span>
<span class="sd">    ...                                   &quot;log10_Intensity BC4_3&quot;, fct=0.7, figsize=(15,5))</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protRatio = prot.filter(regex=&quot;^Ratio .\/.( | normalized )B&quot;).columns</span>
<span class="sd">        prot = pp.log(prot, protRatio, base=2)</span>
<span class="sd">        protInt = prot.filter(regex=&#39;Intensity&#39;).columns</span>
<span class="sd">        prot = pp.log(prot, protInt, base=10)</span>
<span class="sd">        twitchVsmild = [&#39;log2_Ratio H/M normalized BC18_1&#39;,&#39;log2_Ratio M/L normalized BC18_2&#39;,&#39;log2_Ratio H/M normalized BC18_3&#39;,</span>
<span class="sd">                         &#39;log2_Ratio H/L normalized BC36_1&#39;,&#39;log2_Ratio H/M normalized BC36_2&#39;,&#39;log2_Ratio M/L normalized BC36_2&#39;]</span>
<span class="sd">        prot_limma = ana.limma(prot, twitchVsmild, cond=&quot;_TvM&quot;)</span>
<span class="sd">        prot[&quot;log10_Intensity BC4_3&quot;].replace(-np.inf, np.nan, inplace=True)</span>

<span class="sd">        vis.logIntPlot(prot_limma, &quot;logFC_TvM&quot;, &quot;log10_Intensity BC4_3&quot;, fct=0.7, figsize=(15,5))</span>

<span class="sd">    Similar to the visualization using a volcano plot, points of interest can be</span>
<span class="sd">    selected and labelled.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.logIntPlot(prot_limma, &quot;logFC_TvM&quot;, &quot;log10_Intensity BC4_3&quot;,</span>
<span class="sd">                   fct=2, annot=True, interactive=False, hover_name=&quot;Gene names&quot;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        vis.logIntPlot(prot_limma, &quot;logFC_TvM&quot;, &quot;log10_Intensity BC4_3&quot;,</span>
<span class="sd">                       fct=2, annot=True, interactive=False, hover_name=&quot;Gene names&quot;)</span>

<span class="sd">    And the plots can also be investigated interactively</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.logIntPlot(prot_limma, &quot;logFC_TvM&quot;,</span>
<span class="sd">    ...                                   &quot;log10_Intensity BC4_3&quot;, fct=0.7,</span>
<span class="sd">    ...                                   figsize=(15,5), interactive=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Copy features from volcano function (highlight etc)</span>
    <span class="c1"># TODO also add option to not highlight anything</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">])</span><span class="o">&gt;</span><span class="n">fct</span><span class="p">,</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
    <span class="n">unsig</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1">#draw figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unsig</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unsig</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">bg_col</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;background&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">sig_col</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;POI&quot;</span><span class="p">)</span>

        <span class="c1">#draw threshold lines</span>
        <span class="k">if</span> <span class="n">fct</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

        <span class="c1">#remove of top and right plot boundary</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#seting x and y labels and title</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;log Intensity&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;logFC&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="c1">#add legend</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">annot</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="c1">#Annotation</span>
            <span class="c1">#get x and y coordinates as well as strings to plot</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">logFC</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Gene names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sig</span><span class="p">]</span>

            <span class="c1">#annotation</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">ss</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">idx</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">.3</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.25</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">.3</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.25</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">.2</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hover_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Int</span><span class="p">,</span> <span class="n">hover_name</span><span class="o">=</span><span class="n">hover_name</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span><span class="s2">&quot;mistyrose&quot;</span><span class="p">],</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Volcano plot&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">logFC</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Int</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span><span class="s2">&quot;mistyrose&quot;</span><span class="p">],</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Volcano plot&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span> <span class="o">-</span><span class="n">fct</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">fct</span><span class="p">,</span> <span class="n">fct</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">({</span>
            <span class="s1">&#39;plot_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(70,70,70,1)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;paper_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(128, 128, 128, 0.25)&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="MAPlot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.MAPlot">[docs]</a><span class="k">def</span> <span class="nf">MAPlot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MA Plot&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">hover_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot log intensity ratios (M) vs. the average intensity (A).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The MA plot is useful to determine whether a data normalization is needed.</span>
<span class="sd">    The majority of proteins is considered to be unchanged between between</span>
<span class="sd">    treatments and thereofore should lie on the y=0 line.</span>
<span class="sd">    If this is not the case, a normalisation should be applied.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.dataFrame</span>
<span class="sd">        Input dataframe with log intensities.</span>
<span class="sd">    x : str</span>
<span class="sd">        Colname containing intensities of experiment1.</span>
<span class="sd">    y : str</span>
<span class="sd">        Colname containing intensities of experiment2.</span>
<span class="sd">    interactive : bool, optional</span>
<span class="sd">        Whether to return an interactive plotly plot.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    fct : numeric, optional</span>
<span class="sd">        The value in M to draw a horizontal line.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title of the figure. The default is &quot;MA Plot&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Size of the figure. The default is (6,6).</span>
<span class="sd">    hover_name : str, optional</span>
<span class="sd">        Colname to use for labels in interactive plot.</span>
<span class="sd">        The default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The MA plot allows to easily visualize difference in intensities between</span>
<span class="sd">    experiments or replicates and therefore to judge if data normalisation is</span>
<span class="sd">    required for further analysis.</span>
<span class="sd">    The majority of intensities should be unchanged between conditions and</span>
<span class="sd">    therefore most points should lie on the y=0 line.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.MAPlot(prot, twitch, ctrl, fct=2,interactive=False)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protInt = prot.filter(regex=&#39;Intensity&#39;).columns</span>
<span class="sd">        prot = pp.log(prot, protInt, base=10)</span>

<span class="sd">        x = &quot;log10_Intensity BC4_3&quot;</span>
<span class="sd">        y = &quot;log10_Intensity BC36_1&quot;</span>

<span class="sd">        vis.MAPlot(prot, x, y, fct=2,interactive=False)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    If this is not the case, a normalisation using e.g. LOESS should be applied</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.MAPlot(prot, twitch, ctrl, fct=2,interactive=False)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        twitch = &quot;log10_Intensity H BC18_1&quot;</span>
<span class="sd">        ctrl = &quot;log10_Intensity L BC18_1&quot;</span>

<span class="sd">        vis.MAPlot(prot, twitch, ctrl, fct=2,interactive=False)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">fct</span><span class="p">,</span> <span class="s2">&quot;SigCat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1">#draw figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hover_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">hover_name</span><span class="o">=</span><span class="n">hover_name</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span><span class="s2">&quot;mistyrose&quot;</span><span class="p">],</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s2">&quot;SigCat&quot;</span><span class="p">,</span><span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span><span class="s2">&quot;mistyrose&quot;</span><span class="p">],</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">category_orders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SigCat&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">]},</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">fct</span><span class="p">,</span> <span class="n">fct</span><span class="p">],</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">fct</span><span class="p">,</span> <span class="o">-</span><span class="n">fct</span><span class="p">],</span>
                    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;longdash&quot;</span><span class="p">),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">({</span>
            <span class="s1">&#39;plot_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(70,70,70,1)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;paper_bgcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(128, 128, 128, 0.25)&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="meanSd"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.meanSd">[docs]</a><span class="k">def</span> <span class="nf">meanSd</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rank vs. standard deviation plot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    reps : list of str</span>
<span class="sd">        Column names over which to calculate standard deviations and rank.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Visualise the intensity distirbutions of proteins depending on their</span>
<span class="sd">    total indensity.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.meanSd(prot, twitchInt)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        prot = pd.read_csv(&quot;_static/testdata/proteinGroups.zip&quot;, sep=&#39;\t&#39;, low_memory=False)</span>
<span class="sd">        prot = pp.cleaning(prot, &quot;proteinGroups&quot;)</span>
<span class="sd">        protInt = prot.filter(regex=&#39;Intensity&#39;).columns</span>
<span class="sd">        prot = pp.log(prot, protInt, base=10)</span>

<span class="sd">        twitchInt = [&#39;log10_Intensity H BC18_1&#39;,&#39;log10_Intensity M BC18_2&#39;,&#39;log10_Intensity H BC18_3&#39;,</span>
<span class="sd">                 &#39;log10_Intensity BC36_1&#39;,&#39;log10_Intensity H BC36_2&#39;,&#39;log10_Intensity M BC36_2&#39;]</span>

<span class="sd">        vis.meanSd(prot, twitchInt)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">hexa</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;BuPu&quot;</span><span class="p">,</span>
                  <span class="n">gridsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;rank (mean)&quot;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">reps</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">reps</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">JointGrid</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sd&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span>
        <span class="n">hexa</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sd&#39;</span><span class="p">],</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">50</span>
    <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean SD plot&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span></div>

<div class="viewcode-block" id="plotTraces"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.plotTraces">[docs]</a><span class="k">def</span> <span class="nf">plotTraces</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zScore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;logFC&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">plotSummary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plotSummaryOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">summaryColor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
              <span class="n">summaryType</span><span class="o">=</span><span class="s2">&quot;Mean&quot;</span><span class="p">,</span> <span class="n">summaryStyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot numerical data such as fold changes vs. columns (e.g. conditions).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">    cols : list of str</span>
<span class="sd">        The colnames from which the values are plotted.</span>
<span class="sd">    labels : list of str, optional</span>
<span class="sd">        Corresponds to data, used to label traces.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    colors : list of colours, optional</span>
<span class="sd">        Colours to labels the traces.</span>
<span class="sd">        Must be the same length as the values in cols.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    zScore : int, optional</span>
<span class="sd">        Whether to apply zscore transformation.</span>
<span class="sd">        Must be between 0 and 1 for True.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    xlabel : str, optional</span>
<span class="sd">        Label for the x axis. The default is &quot;&quot;.</span>
<span class="sd">    ylabel : str, optional</span>
<span class="sd">        Label for the y axis.</span>
<span class="sd">        The default is &quot;logFC&quot;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title of the plot.</span>
<span class="sd">        The default is &quot;&quot;.</span>
<span class="sd">    ax : matplotlib axis, optional</span>
<span class="sd">        Axis to plot on.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    plotSummary : bool, optional</span>
<span class="sd">        Whether to plot a line corresponding to a summary of the traces as defined</span>
<span class="sd">        by summaryType.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    plotSummaryOnly : bool, optional</span>
<span class="sd">        Whether to plot only the summary.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    summaryColor : Colour-like, optional</span>
<span class="sd">        The colour for the summary.</span>
<span class="sd">        The default is &quot;red&quot;.</span>
<span class="sd">    summaryType : str, optional</span>
<span class="sd">        &quot;Mean&quot; or &quot;Median&quot;. The default is &quot;Mean&quot;.</span>
<span class="sd">    summaryStyle : matplotlib.linestyle, optional</span>
<span class="sd">        Style for the summary trace as defined in</span>
<span class="sd">        https://matplotlib.org/stable/gallery/lines_bars_and_markers/linestyles.html.</span>
<span class="sd">        The default is &quot;solid&quot;.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        passed to matplotlib.pyplot.plot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot the log fold-changes of 10 phosphosites during three comparisons.</span>

<span class="sd">    &gt;&gt;&gt; idx = phos.sample(10).index</span>
<span class="sd">    &gt;&gt;&gt; test = phos.filter(regex=&quot;logFC_&quot;).loc[idx]</span>
<span class="sd">    &gt;&gt;&gt; label = phos.loc[idx, &quot;Gene names&quot;]</span>
<span class="sd">    &gt;&gt;&gt; vis.plotTraces(test, test.columns, labels=label, colors=[&quot;red&quot;, &quot;green&quot;]*5,</span>
<span class="sd">    ...                xlabel=&#39;Column&#39;, zScore=None)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        phos = pd.read_csv(&quot;_static/testdata/Phospho (STY)Sites_mod.zip&quot;, sep=&quot;\t&quot;, low_memory=False)</span>
<span class="sd">        phos = pp.cleaning(phos, file = &quot;Phospho (STY)&quot;)</span>
<span class="sd">        phosRatio = phos.filter(regex=&quot;^Ratio .\/.( | normalized )R.___&quot;).columns</span>
<span class="sd">        phos = pp.log(phos, phosRatio, base=2)</span>
<span class="sd">        phos = pp.filterLocProb(phos, thresh=.75)</span>
<span class="sd">        phosRatio = phos.filter(regex=&quot;log2_Ratio .\/.( | normalized )R.___&quot;).columns</span>
<span class="sd">        phos = pp.removeNonQuant(phos, phosRatio)</span>

<span class="sd">        phosRatio = phos.filter(regex=&quot;log2_Ratio .\/. normalized R.___&quot;)</span>
<span class="sd">        phos_expanded = pp.expandSiteTable(phos, phosRatio)</span>

<span class="sd">        twitchVsmild = [&#39;log2_Ratio H/M normalized R1&#39;,&#39;log2_Ratio M/L normalized R2&#39;,&#39;log2_Ratio H/M normalized R3&#39;,</span>
<span class="sd">                        &#39;log2_Ratio H/L normalized R4&#39;,&#39;log2_Ratio H/M normalized R5&#39;,&#39;log2_Ratio M/L normalized R6&#39;]</span>
<span class="sd">        twitchVsctrl = [&quot;log2_Ratio H/L normalized R1&quot;,&quot;log2_Ratio H/M normalized R2&quot;,&quot;log2_Ratio H/L normalized R3&quot;,</span>
<span class="sd">                        &quot;log2_Ratio M/L normalized R4&quot;, &quot;log2_Ratio H/L normalized R5&quot;,&quot;log2_Ratio H/M normalized R6&quot;]</span>
<span class="sd">        mildVsctrl = [&quot;log2_Ratio M/L normalized R1&quot;,&quot;log2_Ratio H/L normalized R2&quot;,&quot;log2_Ratio M/L normalized R3&quot;,</span>
<span class="sd">                      &quot;log2_Ratio H/M normalized R4&quot;,&quot;log2_Ratio M/L normalized R5&quot;,&quot;log2_Ratio H/L normalized R6&quot;]</span>
<span class="sd">        phos = ana.ttest(df=phos_expanded, reps=twitchVsmild, cond=&quot;TvM&quot;, mean=True)</span>
<span class="sd">        phos = ana.ttest(df=phos_expanded, reps=twitchVsctrl, cond=&quot;TvC&quot;, mean=True)</span>
<span class="sd">        phos = ana.ttest(df=phos_expanded, reps=twitchVsmild, cond=&quot;MvC&quot;, mean=True)</span>

<span class="sd">        idx = phos.sample(10).index</span>
<span class="sd">        test = phos.filter(regex=&quot;logFC_&quot;).loc[idx]</span>
<span class="sd">        label = phos.loc[idx, &quot;Gene names&quot;]</span>
<span class="sd">        vis.plotTraces(test, test.columns, labels=label, colors=[&quot;red&quot;, &quot;green&quot;]*5,</span>
<span class="sd">                       xlabel=&#39;Column&#39;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO Add parameter to plot yerr</span>
    <span class="c1"># TODO xlabels from colnames</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">zScore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">zScore</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">zscore</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">zScore</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotSummaryOnly</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">+=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotSummary</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">plotSummaryOnly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">summaryType</span> <span class="o">==</span> <span class="s2">&quot;Mean&quot;</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">summaryColor</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">summaryStyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">summaryType</span> <span class="o">==</span> <span class="s2">&quot;Median&quot;</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">summaryColor</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">summaryStyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">f</span><span class="p">):</span>
            <span class="c1">#get last point for annotation</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span></div>


<div class="viewcode-block" id="sequenceLogo"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.sequenceLogo">[docs]</a><span class="k">def</span> <span class="nf">sequenceLogo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">motif</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ST</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate sequence logo plot based on experimentally observed phosphosites.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        The dataframe from which experimentally determined sequences are extracted.</span>
<span class="sd">    motif : tuple of str</span>
<span class="sd">        A tuple of the motif and its name.</span>
<span class="sd">        The phosphosite residue in the motif should be indicated by a</span>
<span class="sd">        lowercase character.</span>
<span class="sd">        Example (&quot;..R.R..s.......&quot;, &quot;MK_down&quot;).</span>
<span class="sd">    file : str</span>
<span class="sd">        Path to write the figure to file.</span>
<span class="sd">        Default is None.</span>
<span class="sd">    ST : bool, optional</span>
<span class="sd">        If true, the phoshoresidue will be considered to be</span>
<span class="sd">        either S or T. The default is False.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the phosphoresidue was not indicated by lowercase character.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    First define the motif of interest. Note that the phosphorylated residue</span>
<span class="sd">    should be marked by a lowercase character.</span>

<span class="sd">    &gt;&gt;&gt; motif = (&quot;..R.R..s.......&quot;, &quot;MK_down&quot;)</span>
<span class="sd">    &gt;&gt;&gt; autoprot.visualization.sequenceLogo(phos, motif)</span>

<span class="sd">    allow s and t as central residue</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.sequenceLogo(phos, motif, path, ST=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: motif and name should be provided in 2 parameter</span>

    <span class="k">def</span> <span class="nf">generateSequenceLogo</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">motif</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a sequence logo plot for a motif.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        seq : list of str</span>
<span class="sd">            List of experimentally determined sequences matching the motif.</span>
<span class="sd">        file : str</span>
<span class="sd">            path to folder where the output file will be written.</span>
<span class="sd">            Default is None.</span>
<span class="sd">        motif : str, optional</span>
<span class="sd">            The motif used to find the sequences.</span>
<span class="sd">            The default is &quot;&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aa_dic</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;V&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;F&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;K&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Q&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seq</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">seqT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">seq</span><span class="p">)]</span>
        <span class="n">scoreMatrix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">seqT</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">aa_dic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">:</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">aa</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="ow">or</span> <span class="n">aa</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span> <span class="ow">or</span> <span class="n">aa</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">aa</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">scoreMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">scoreMatrix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>

        <span class="c1">#empty array -&gt; (sequenceWindow, aa)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">scoreMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>

        <span class="c1"># create Logo object</span>
        <span class="n">kinase_motif_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">kinase_motif_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">aa_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">k_logo</span> <span class="o">=</span> <span class="n">logomaker</span><span class="o">.</span><span class="n">Logo</span><span class="p">(</span><span class="n">kinase_motif_df</span><span class="p">,</span>
                                 <span class="n">font_name</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
                                 <span class="n">color_scheme</span><span class="o">=</span><span class="s1">&#39;dmslogo_funcgroup&#39;</span><span class="p">,</span>
                                 <span class="n">vpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">width</span><span class="o">=</span><span class="mf">.8</span><span class="p">)</span>

        <span class="n">k_logo</span><span class="o">.</span><span class="n">highlight_position</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SequenceLogo&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">motif</span><span class="p">))</span>
        <span class="c1">#labels=k_logo.ax.get_xticklabels()</span>
        <span class="n">k_logo</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]);</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_motif</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">motif</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">ST</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the input motif if it fits to the value provided in &quot;Sequence window&quot; of a dataframe row.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : pd.DataFrame</span>
<span class="sd">            Dataframe containing the identified sequence windows.</span>
<span class="sd">        motif : str</span>
<span class="sd">            The kinase motif.</span>
<span class="sd">        typ : str</span>
<span class="sd">            The kinase motif.</span>
<span class="sd">        ST : bool, optional</span>
<span class="sd">            Look for S and T at the phosphorylation position.</span>
<span class="sd">            The phoshorylated residue should be S or T, otherwise it is transformed</span>
<span class="sd">            to S/T.</span>
<span class="sd">            The default is False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If not lowercase phosphoresidue is given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        typ : str</span>
<span class="sd">            The kinase motif.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="c1"># identified sequence window</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Sequence window&quot;</span><span class="p">]</span>
        <span class="c1">#In Sequence window the aa of interest is always at pos 15</span>
        <span class="c1">#This loop will check if the motif we are interested in is</span>
        <span class="c1">#centered with its phospho residue at pos 15 of the sequence window</span>
        <span class="n">checkLower</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">motif</span><span class="p">):</span>
            <span class="c1"># the phosphorsidue in the motif is indicated by lowercase character</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># pos1 is position of the phosphosite in the motif</span>
                <span class="n">pos1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">motif</span><span class="p">)</span><span class="o">-</span><span class="n">j</span>
                <span class="n">checkLower</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">checkLower</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Phosphoresidue has to be lower case!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ST</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># insert the expression (S/T) on the position of the phosphosite</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[:</span><span class="n">pos1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(S|T)&quot;</span> <span class="o">+</span> <span class="n">motif</span><span class="p">[</span><span class="n">pos1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># for finding pos2, the whole motif is uppercase</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="n">motif</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">pos2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># pos2 is the last position of the matched sequence</span>
        <span class="c1"># the MQ Sequence window is always 30 AAs long and centred on the modified</span>
        <span class="c1"># amino acid. Hence for a true hit, pos2-pos1 should be 15</span>
        <span class="k">if</span> <span class="n">pos2</span><span class="p">:</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos2</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos2</span><span class="o">-</span><span class="n">pos1</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">typ</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># init empty col corresponding to sequence motif</span>
    <span class="n">df</span><span class="p">[</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="c1"># returns the input sequence motif for rows where the motif fits the sequence</span>
    <span class="c1"># window</span>
    <span class="n">df</span><span class="p">[</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">find_motif</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ST</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># consider only the +- 7 amino acids around the modified residue (x[8:23])</span>
        <span class="n">generateSequenceLogo</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Sequence window&quot;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">23</span><span class="p">]),</span>
                            <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot;/</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.svg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">motif</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">generateSequenceLogo</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Sequence window&quot;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">23</span><span class="p">]),</span>
                             <span class="n">motif</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>

<div class="viewcode-block" id="visPs"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.visPs">[docs]</a><span class="k">def</span> <span class="nf">visPs</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">domain_position</span><span class="o">=</span><span class="p">[],</span> <span class="n">ps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pls</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">domain_color</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize domains and phosphosites on a protein of interest.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of the protein.</span>
<span class="sd">        Used for plot title.</span>
<span class="sd">    length : int</span>
<span class="sd">        Length of the protein.</span>
<span class="sd">    domain_position : list of tuples of int</span>
<span class="sd">        Each element is a tuple of domain start and end postiions.</span>
<span class="sd">    ps : list of int</span>
<span class="sd">        position of phosphosites.</span>
<span class="sd">    pl : list of str</span>
<span class="sd">        label for ps (has to be in same order as ps).</span>
<span class="sd">    plc : list of colours</span>
<span class="sd">        optionally one can provide a list of colors for the phosphosite labels.</span>
<span class="sd">    pls : int, optional</span>
<span class="sd">        Fontsize for the phosphosite labels. The default is 4.</span>
<span class="sd">    ax: matplotlib axis, optional</span>
<span class="sd">        To draw on an existing axis</span>
<span class="sd">    domain_color: str</span>
<span class="sd">        Either a matplotlib colormap (see https://predictablynoisy.com/matplotlib/gallery/color/colormap_reference.html)</span>
<span class="sd">        or a single color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure</span>
<span class="sd">        The figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Draw an overview on the phosphorylation of AKT1S1.</span>

<span class="sd">    &gt;&gt;&gt; name = &quot;AKT1S1&quot;</span>
<span class="sd">    &gt;&gt;&gt; length = 256</span>
<span class="sd">    &gt;&gt;&gt; domain_position = [35,43,</span>
<span class="sd">    ...                    77,96]</span>
<span class="sd">    &gt;&gt;&gt; ps = [88, 92, 116, 183, 202, 203, 211, 212, 246]</span>
<span class="sd">    &gt;&gt;&gt; pl = [&quot;pS88&quot;, &quot;pS92&quot;, &quot;pS116&quot;, &quot;pS183&quot;, &quot;pS202&quot;, &quot;pS203&quot;, &quot;pS211&quot;, &quot;pS212&quot;, &quot;pS246&quot;]</span>

<span class="sd">    colors (A,B,C,D (gray -&gt; purple), Ad, Bd, Cd, Dd (gray -&gt; teal) can be used to indicate regulation)</span>

<span class="sd">    &gt;&gt;&gt; plc = [&#39;C&#39;, &#39;A&#39;, &#39;A&#39;, &#39;C&#39;, &#39;Cd&#39;, &#39;D&#39;, &#39;D&#39;, &#39;B&#39;, &#39;D&#39;]</span>
<span class="sd">    &gt;&gt;&gt; autoprot.visualization.visPs(name, length, domain_position, ps, pl, plc, pls=12)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.visualization as vis</span>

<span class="sd">        name = &quot;AKT1S1&quot;</span>
<span class="sd">        length = 256</span>
<span class="sd">        domain_position = [(35,43),</span>
<span class="sd">                           (77,96)]</span>
<span class="sd">        ps = [88, 92, 116, 183, 202, 203, 211, 212, 246]</span>
<span class="sd">        pl = [&quot;pS88&quot;, &quot;pS92&quot;, &quot;pS116&quot;, &quot;pS183&quot;, &quot;pS202&quot;, &quot;pS203&quot;, &quot;pS211&quot;, &quot;pS212&quot;, &quot;pS246&quot;]</span>
<span class="sd">        plc = [&#39;C&#39;, &#39;A&#39;, &#39;A&#39;, &#39;C&#39;, &#39;Cd&#39;, &#39;D&#39;, &#39;D&#39;, &#39;B&#39;, &#39;D&#39;]</span>
<span class="sd">        vis.visPs(name, length, domain_position, ps, pl, plc, pls=12)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if domain_color is a cmap name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">domain_color</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">cm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">domain_position</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># it is not, so is it a single colour?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain_color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">domain_color</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">domain_position</span><span class="p">)</span>
        <span class="c1"># is it a list of colours</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain_color</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain_color</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain_position</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">domain_color</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Please provide one domain colour per domain&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;You must provide a colormap name, a colour name or a list of colour names&#39;</span><span class="p">)</span>

    <span class="n">textColor</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span>  <span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Ad&quot;</span> <span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;B&quot;</span>  <span class="p">:</span> <span class="s2">&quot;#dc86fa&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Bd&quot;</span> <span class="p">:</span> <span class="s2">&quot;#6AC9BE&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;C&quot;</span>  <span class="p">:</span> <span class="s2">&quot;#aa00d7&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Cd&quot;</span> <span class="p">:</span> <span class="s2">&quot;#239895&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;D&quot;</span>  <span class="p">:</span> <span class="s2">&quot;#770087&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Dd&quot;</span> <span class="p">:</span> <span class="s2">&quot;#008080&quot;</span><span class="p">}</span>

    <span class="n">lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">25</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">ax</span>

    <span class="c1"># background of the whole protein in grey</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">length</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">domain_position</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="p">)</span>

    <span class="c1"># only plot phosphosite if there are any</span>
    <span class="k">if</span> <span class="n">ps</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ps</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">site</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">site</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">height</span><span class="o">-</span><span class="p">(</span><span class="n">height</span><span class="o">+</span><span class="n">height</span><span class="o">*</span><span class="mf">0.15</span><span class="p">),</span>
                     <span class="n">pl</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">pl</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="n">pls</span><span class="p">,</span>
                     <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">textColor</span><span class="p">[</span><span class="n">plc</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="k">if</span> <span class="n">plc</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>


<div class="viewcode-block" id="styCountPlot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.styCountPlot">[docs]</a><span class="k">def</span> <span class="nf">styCountPlot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">retFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw an overview of Number of Phospho (STY) of a Phospho(STY) file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">        Must contain a column &quot;Number of Phospho (STY)&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        Figure size. The default is (12,8).</span>
<span class="sd">    typ : str, optional</span>
<span class="sd">        &#39;bar&#39; or &#39;pie&#39;. The default is &quot;bar&quot;.</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether to return the figure. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure</span>
<span class="sd">        The figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot a bar chart of the distribution of the number of phosphosites on the peptides.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.styCountPlot(phos, typ=&quot;bar&quot;)</span>
<span class="sd">    Number of phospho (STY) [total] - (count / # Phospho)</span>
<span class="sd">    [(29, 0), (37276, 1), (16460, 2), (4276, 3), (530, 4), (52, 5)]</span>
<span class="sd">    Percentage of phospho (STY) [total] - (% / # Phospho)</span>
<span class="sd">    [(0.05, 0), (63.59, 1), (28.08, 2), (7.29, 3), (0.9, 4), (0.09, 5)]</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        phos = pd.read_csv(&quot;_static/testdata/Phospho (STY)Sites_mod.zip&quot;, sep=&quot;\t&quot;, low_memory=False)</span>
<span class="sd">        phos = pp.cleaning(phos, file = &quot;Phospho (STY)&quot;)</span>
<span class="sd">        vis.styCountPlot(phos, typ=&quot;bar&quot;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">noOfPhos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Number of Phospho (STY)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)]))]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">[(</span><span class="n">noOfPhos</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)]</span>
    <span class="n">counts_perc</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">noOfPhos</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of phospho (STY) [total] - (count / # Phospho)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Percentage of phospho (STY) [total] - (% / # Phospho)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counts_perc</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Number of Phospho (STY)&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Number of Phospho (STY)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Number of Phospho (STY)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Phospho (STY)&#39;</span><span class="p">)</span>
        <span class="n">ncount</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Make twin axis</span>
        <span class="n">ax2</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [%]&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">ncount</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span> <span class="c1"># set the alignment of the text</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">LinearLocator</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ncount</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s2">&quot;pie&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">]);</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of Phosphosites&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retFig</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="chargePlot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.chargePlot">[docs]</a><span class="k">def</span> <span class="nf">chargePlot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">retFig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a pie chart of the peptide charges of a phospho(STY) dataframe.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.Dataframe</span>
<span class="sd">        Input dataframe.</span>
<span class="sd">        Must contain a column named &quot;Charge&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        The size of the figure. The default is (12,8).</span>
<span class="sd">    typ : str, optional</span>
<span class="sd">        &quot;pie&quot; or &quot;bar&quot;.</span>
<span class="sd">        The default is &quot;bar&quot;.</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether to return the figure.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    ax : matplotlib axis</span>
<span class="sd">        Axis to plot on</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure</span>
<span class="sd">        The figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot the charge states of a dataframe.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.chargePlot(phos, typ=&quot;pie&quot;)</span>
<span class="sd">    charge [total] - (count / # charge)</span>
<span class="sd">    [(44, 1), (20583, 2), (17212, 3), (2170, 4), (61, 5), (4, 6)]</span>
<span class="sd">    Percentage of charge [total] - (% / # charge)</span>
<span class="sd">    [(0.11, 1), (51.36, 2), (42.95, 3), (5.41, 4), (0.15, 5), (0.01, 6)]</span>
<span class="sd">    charge [total] - (count / # charge)</span>
<span class="sd">    [(44, 1), (20583, 2), (17212, 3), (2170, 4), (61, 5), (4, 6)]</span>
<span class="sd">    Percentage of charge [total] - (% / # charge)</span>
<span class="sd">    [(0.11, 1), (51.36, 2), (42.95, 3), (5.41, 4), (0.15, 5), (0.01, 6)]</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        phos = pd.read_csv(&quot;_static/testdata/Phospho (STY)Sites_mod.zip&quot;, sep=&quot;\t&quot;, low_memory=False)</span>
<span class="sd">        phos = pp.cleaning(phos, file = &quot;Phospho (STY)&quot;)</span>
<span class="sd">        vis.chargePlot(phos, typ=&quot;pie&quot;)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">noOfPhos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Charge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)]))]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">[(</span><span class="n">noOfPhos</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)]</span>
    <span class="n">counts_perc</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">noOfPhos</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;charge [total] - (count / # charge)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Percentage of charge [total] - (% / # charge)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counts_perc</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">noOfPhos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
        <span class="n">ncount</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Make twin axis</span>
        <span class="n">ax2</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [%]&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">ncount</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span> <span class="c1"># set the alignment of the text</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">LinearLocator</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ncount</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s2">&quot;pie&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">]);</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retFig</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="modAa"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.modAa">[docs]</a><span class="k">def</span> <span class="nf">modAa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">retFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count the number of modifications per amino acid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.Dataframe</span>
<span class="sd">        The input dataframe.</span>
<span class="sd">        Must contain a column &quot;Amino acid&quot;.</span>
<span class="sd">    figsize : tuple of int, optional</span>
<span class="sd">        The size of the figure. The default is (6,6).</span>
<span class="sd">    retFig : bool, optional</span>
<span class="sd">        Whether to return the figure object. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure</span>
<span class="sd">        The figure object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot pie chart of modified amino acids.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.modAa(phos)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        phos = pd.read_csv(&quot;_static/testdata/Phospho (STY)Sites_mod.zip&quot;, sep=&quot;\t&quot;, low_memory=False)</span>
<span class="sd">        phos = pp.cleaning(phos, file = &quot;Phospho (STY)&quot;)</span>
<span class="sd">        vis.modAa(phos)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;%&#39;</span>
              <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Amino acid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                             <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Amino acid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Amino acid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
           <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="n">labels</span><span class="p">));</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Modified AAs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="wordcloud"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.wordcloud">[docs]</a><span class="k">def</span> <span class="nf">wordcloud</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pdffile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exlusionwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="n">contour_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate Wordcloud from string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        text input as a string.</span>
<span class="sd">    exlusionwords : list of str, optional</span>
<span class="sd">        list of words to exclude from wordcloud. The default is None.</span>
<span class="sd">    background_color : colour, optional</span>
<span class="sd">        The background colour of the plot. The default is &quot;white&quot;.</span>
<span class="sd">    mask : &#39;round&#39; or path to png file, optional</span>
<span class="sd">        Used to mask the wordcloud.</span>
<span class="sd">        set it either to round or true and add a .png file.</span>
<span class="sd">        The default is None.</span>
<span class="sd">    file : str, optional</span>
<span class="sd">        file is given as path with path/to/file.filetype.</span>
<span class="sd">        The default is &quot;&quot;.</span>
<span class="sd">    contour_width : int, optional</span>
<span class="sd">        If mask is not None and contour_width &gt; 0, draw the mask contour.</span>
<span class="sd">        The default is 0.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        passed to wordcloud.WordCloud.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot Hello World</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.wordcloud(text=&quot;hello world!&quot;, contour_width=5, mask=&#39;round&#39;)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        vis.wordcloud(text=&quot;hello world!&quot;, contour_width=5, mask=&#39;round&#39;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    You can also use the extractPDF method to input a pdf text instead of a text</span>
<span class="sd">    string</span>

<span class="sd">    &gt;&gt;&gt; text = autoprot.visualization.wordcloud.extractPDF(&#39;/path/to/pdf&#39;)</span>
<span class="sd">    &gt;&gt;&gt; autoprot.visualization.wordcloud(text=&quot;hello world!&quot;, contour_width=5, mask=&#39;round&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">extractPDF</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract text from PDF file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            Path to pdf file.</span>
<span class="sd">        ----------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_manager</span> <span class="o">=</span> <span class="n">PDFResourceManager</span><span class="p">()</span>
        <span class="n">fake_file_handle</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">converter</span> <span class="o">=</span> <span class="n">TextConverter</span><span class="p">(</span><span class="n">resource_manager</span><span class="p">,</span> <span class="n">fake_file_handle</span><span class="p">,</span> <span class="n">laparams</span><span class="o">=</span><span class="n">LAParams</span><span class="p">())</span>
        <span class="n">page_interpreter</span> <span class="o">=</span> <span class="n">PDFPageInterpreter</span><span class="p">(</span><span class="n">resource_manager</span><span class="p">,</span> <span class="n">converter</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="c1"># &#39;rb&#39; is opening the pdf file in binary mode</span>

            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">PDFPage</span><span class="o">.</span><span class="n">get_pages</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span>
                                          <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">check_extractable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">page_interpreter</span><span class="o">.</span><span class="n">process_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">fake_file_handle</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="c1"># close open handles</span>
        <span class="n">converter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">fake_file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">if</span> <span class="n">exlusionwords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exlusionwords</span> <span class="o">=</span> <span class="n">exlusionwords</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">STOPWORDS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[:</span><span class="mi">1000</span><span class="p">,</span> <span class="p">:</span><span class="mi">1000</span><span class="p">]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">500</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">500</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">400</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">contour_width</span><span class="o">=</span><span class="n">contour_width</span><span class="p">,</span>
                       <span class="n">stopwords</span><span class="o">=</span><span class="n">exlusionwords</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span><span class="n">stopwords</span><span class="o">=</span><span class="n">exlusionwords</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wc</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">wc</span></div>


<div class="viewcode-block" id="BHplot"><a class="viewcode-back" href="../../visualization.html#autoprot.visualization.BHplot">[docs]</a><span class="k">def</span> <span class="nf">BHplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">adj_ps</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize Benjamini Hochberg p-value correction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with p values.</span>
<span class="sd">    ps : str</span>
<span class="sd">        Colname of column with p-values.</span>
<span class="sd">    adj_ps : str</span>
<span class="sd">        column with adj_p values.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Plot title. The default is None.</span>
<span class="sd">    alpha : flaot, optional</span>
<span class="sd">        The significance level drawn in the plot. The default is 0.05.</span>
<span class="sd">    zoom : int, optional</span>
<span class="sd">        Zoom on the first n points. The default is 20.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The function generates two plots, left with all datapoints sorted by p-value</span>
<span class="sd">    and right with a zoom on the first 6 values (zoom=7).</span>
<span class="sd">    The grey line indicates the provided alpha level. Values below it are considered</span>
<span class="sd">    significantly different.</span>

<span class="sd">    &gt;&gt;&gt; autoprot.visualization.BHplot(phos,&#39;pValue_TvC&#39;, &#39;adj.pValue_TvC&#39;, alpha=0.05, zoom=7)</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :context: close-figs</span>

<span class="sd">        import autoprot.preprocessing as pp</span>
<span class="sd">        import autoprot.analysis as ana</span>
<span class="sd">        import autoprot.visualization as vis</span>
<span class="sd">        import pandas as pd</span>

<span class="sd">        phos = pd.read_csv(&quot;_static/testdata/Phospho (STY)Sites_mod.zip&quot;, sep=&quot;\t&quot;, low_memory=False)</span>
<span class="sd">        phos = pp.cleaning(phos, file = &quot;Phospho (STY)&quot;)</span>
<span class="sd">        phosRatio = phos.filter(regex=&quot;^Ratio .\/.( | normalized )R.___&quot;).columns</span>
<span class="sd">        phos = pp.log(phos, phosRatio, base=2)</span>
<span class="sd">        phos = pp.filterLocProb(phos, thresh=.75)</span>
<span class="sd">        phosRatio = phos.filter(regex=&quot;log2_Ratio .\/.( | normalized )R.___&quot;).columns</span>
<span class="sd">        phos = pp.removeNonQuant(phos, phosRatio)</span>

<span class="sd">        phosRatio = phos.filter(regex=&quot;log2_Ratio .\/. normalized R.___&quot;)</span>
<span class="sd">        phos_expanded = pp.expandSiteTable(phos, phosRatio)</span>

<span class="sd">        mildVsctrl = [&quot;log2_Ratio M/L normalized R1&quot;,&quot;log2_Ratio H/L normalized R2&quot;,&quot;log2_Ratio M/L normalized R3&quot;,</span>
<span class="sd">                      &quot;log2_Ratio H/M normalized R4&quot;,&quot;log2_Ratio M/L normalized R5&quot;,&quot;log2_Ratio H/L normalized R6&quot;]</span>

<span class="sd">        phos = ana.ttest(df=phos_expanded, reps=mildVsctrl, cond=&quot;MvC&quot;, mean=True)</span>

<span class="sd">        vis.BHplot(phos,&#39;pValue_MvC&#39;, &#39;adj.pValue_MvC&#39;, alpha=0.05, zoom=7)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">n</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\frac{i * \alpha}</span><span class="si">{n}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;p_values&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">adj_ps</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;adj. p_values&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">zoom</span><span class="p">],</span><span class="n">y</span><span class="p">[:</span><span class="n">zoom</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">zoom</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">zoom</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;p_values&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">zoom</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">adj_ps</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="n">zoom</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;adj. p_values&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The autoprot contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>